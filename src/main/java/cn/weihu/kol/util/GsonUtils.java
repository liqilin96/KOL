package cn.weihu.kol.util;

import com.google.gson.*;
import lombok.extern.slf4j.Slf4j;

import java.lang.reflect.ParameterizedType;
import java.lang.reflect.Type;
import java.util.Map;

/**
 * Created by liu-pc on 2019/12/27.
 */
@Slf4j
public class GsonUtils {
    public static Gson gson = new Gson();
    public static Gson eventgson = new GsonBuilder().addSerializationExclusionStrategy(new ExclusionStrategy() {
        @Override
        public boolean shouldSkipField(FieldAttributes fa) {
            String newvarname = fa.getName();
            if (newvarname.equals("eventBody")||newvarname.equals("decodeEventHeaders")||newvarname.equals("fshost")) {
                return false;
            }
            return true;
        }

        @Override
        public boolean shouldSkipClass(Class<?> arg0) {
            return false;
        }
    }).create();

    public static ParameterizedType type(final Class raw, final Type... args) {
        return new ParameterizedType() {
            public Type getRawType() {
                return raw;
            }

            public Type[] getActualTypeArguments() {
                return args;
            }

            public Type getOwnerType() {
                return null;
            }
        };
    }

    public static void main(String[] args) {
        String json = "{\"Event-Name\":\"CHANNEL_HANGUP_COMPLETE\",\"Core-UUID\":\"ac1100bb-69b2-4759-a477-a244208793a3\",\"FreeSWITCH-Hostname\":\"gitserver\",\"FreeSWITCH-Switchname\":\"gitserver\",\"FreeSWITCH-IPv4\":\"192.168.0.216\",\"FreeSWITCH-IPv6\":\"::1\",\"Event-Date-Local\":\"2021-04-27 17:41:24\",\"Event-Date-GMT\":\"Tue, 27 Apr 2021 09:41:24 GMT\",\"Event-Date-Timestamp\":\"1619516484582863\",\"Event-Calling-File\":\"switch_core_state_machine.c\",\"Event-Calling-Function\":\"switch_core_session_reporting_state\",\"Event-Calling-Line-Number\":\"947\",\"Event-Sequence\":\"1723\",\"Hangup-Cause\":\"NORMAL_CLEARING\",\"Channel-State\":\"CS_REPORTING\",\"Channel-Call-State\":\"HANGUP\",\"Channel-State-Number\":\"11\",\"Channel-Name\":\"sofia/external/19123456789@192.168.0.57:9080\",\"Unique-ID\":\"0713bb1e-17d7-47fa-b3e1-061512878440\",\"Call-Direction\":\"outbound\",\"Presence-Call-Direction\":\"outbound\",\"Channel-HIT-Dialplan\":\"true\",\"Channel-Call-UUID\":\"0713bb1e-17d7-47fa-b3e1-061512878440\",\"Answer-State\":\"hangup\",\"Hangup-Cause\":\"NORMAL_CLEARING\",\"Channel-Read-Codec-Name\":\"PCMU\",\"Channel-Read-Codec-Rate\":\"8000\",\"Channel-Read-Codec-Bit-Rate\":\"64000\",\"Channel-Write-Codec-Name\":\"PCMU\",\"Channel-Write-Codec-Rate\":\"8000\",\"Channel-Write-Codec-Bit-Rate\":\"64000\",\"Caller-Direction\":\"outbound\",\"Caller-Logical-Direction\":\"outbound\",\"Caller-Caller-ID-Name\":\"19123456789\",\"Caller-Caller-ID-Number\":\"19123456789\",\"Caller-Orig-Caller-ID-Number\":\"12345\",\"Caller-Callee-ID-Number\":\"12345\",\"Caller-Network-Addr\":\"192.168.0.57\",\"Caller-ANI\":\"12345\",\"Caller-Destination-Number\":\"19123456789\",\"Caller-Unique-ID\":\"0713bb1e-17d7-47fa-b3e1-061512878440\",\"Caller-Source\":\"src/switch_ivr_originate.c\",\"Caller-Context\":\"default\",\"Caller-Channel-Name\":\"sofia/external/19123456789@192.168.0.57:9080\",\"Caller-Profile-Index\":\"1\",\"Caller-Profile-Created-Time\":\"1619516452542864\",\"Caller-Channel-Created-Time\":\"1619516452542864\",\"Caller-Channel-Answered-Time\":\"1619516454582862\",\"Caller-Channel-Progress-Time\":\"0\",\"Caller-Channel-Progress-Media-Time\":\"1619516452562840\",\"Caller-Channel-Hangup-Time\":\"1619516484582863\",\"Caller-Channel-Transfer-Time\":\"0\",\"Caller-Channel-Resurrect-Time\":\"0\",\"Caller-Channel-Bridged-Time\":\"0\",\"Caller-Channel-Last-Hold\":\"0\",\"Caller-Channel-Hold-Accum\":\"0\",\"Caller-Screen-Bit\":\"true\",\"Caller-Privacy-Hide-Name\":\"false\",\"Caller-Privacy-Hide-Number\":\"false\",\"variable_direction\":\"outbound\",\"variable_is_outbound\":\"true\",\"variable_uuid\":\"0713bb1e-17d7-47fa-b3e1-061512878440\",\"variable_session_id\":\"7\",\"variable_sip_profile_name\":\"external\",\"variable_video_media_flow\":\"disabled\",\"variable_text_media_flow\":\"disabled\",\"variable_channel_name\":\"sofia/external/19123456789@192.168.0.57:9080\",\"variable_sip_destination_url\":\"sip:19123456789@192.168.0.57:9080\",\"variable_ctiip\":\"192-168-0-238\",\"variable_calltype\":\"out\",\"variable_origination_caller_id_number\":\"12345\",\"variable_codec_string\":\"PCMU,PCMA\",\"variable_originate_early_media\":\"true\",\"variable_rtp_local_sdp_str\":\"v=0\\r\\no=FreeSWITCH 1619485248 1619485249 IN IP4 192.168.0.216\\r\\ns=FreeSWITCH\\r\\nc=IN IP4 192.168.0.216\\r\\nt=0 0\\r\\nm=audio 31204 RTP/AVP 0 8 101\\r\\na=rtpmap:0 PCMU/8000\\r\\na=rtpmap:8 PCMA/8000\\r\\na=rtpmap:101 telephone-event/8000\\r\\na=fmtp:101 0-16\\r\\na=rtcp-mux\\r\\na=rtcp:31204 IN IP4 192.168.0.216\\r\\na=ptime:20\\r\\na=sendrecv\\r\\n\",\"variable_sip_outgoing_contact_uri\":\"<sip:mod_sofia@192.168.0.216:9080>\",\"variable_sip_req_uri\":\"19123456789@192.168.0.57:9080\",\"variable_sofia_profile_name\":\"external\",\"variable_recovery_profile_name\":\"external\",\"variable_sofia_profile_url\":\"sip:mod_sofia@192.168.0.216:9080\",\"variable_rtp_use_codec_string\":\"PCMU,PCMA\",\"variable_remote_video_media_flow\":\"inactive\",\"variable_remote_text_media_flow\":\"inactive\",\"variable_remote_audio_media_flow\":\"sendrecv\",\"variable_audio_media_flow\":\"sendrecv\",\"variable_rtp_audio_recv_pt\":\"0\",\"variable_rtp_use_codec_name\":\"PCMU\",\"variable_rtp_use_codec_rate\":\"8000\",\"variable_rtp_use_codec_ptime\":\"20\",\"variable_rtp_use_codec_channels\":\"1\",\"variable_rtp_last_audio_codec_string\":\"PCMU@8000h@20i@1c\",\"variable_read_codec\":\"PCMU\",\"variable_original_read_codec\":\"PCMU\",\"variable_read_rate\":\"8000\",\"variable_original_read_rate\":\"8000\",\"variable_write_codec\":\"PCMU\",\"variable_write_rate\":\"8000\",\"variable_dtmf_type\":\"rfc2833\",\"variable_local_media_ip\":\"192.168.0.216\",\"variable_local_media_port\":\"31204\",\"variable_advertised_media_ip\":\"192.168.0.216\",\"variable_rtp_use_timer_name\":\"soft\",\"variable_rtp_use_pt\":\"0\",\"variable_rtp_use_ssrc\":\"3163207532\",\"variable_rtp_2833_send_payload\":\"101\",\"variable_rtp_2833_recv_payload\":\"101\",\"variable_remote_media_ip\":\"192.168.0.57\",\"variable_remote_media_port\":\"28986\",\"variable_pre_transfer_caller_id_number\":\"12345\",\"variable_call_uuid\":\"0713bb1e-17d7-47fa-b3e1-061512878440\",\"variable_current_application_data\":\"file_string://queue.wav!\",\"variable_current_application\":\"playback\",\"variable_RECORD_TITLE\":\"�ؼ� (����˹����)\",\"variable_RECORD_ARTIST\":\"Ⱥ��\",\"variable_sip_local_network_addr\":\"192.168.0.216\",\"variable_sip_reply_host\":\"192.168.0.57\",\"variable_sip_reply_port\":\"9080\",\"variable_sip_network_ip\":\"192.168.0.57\",\"variable_sip_network_port\":\"9080\",\"variable_ep_codec_string\":\"CORE_PCM_MODULE.PCMU@8000h@20i@64000b\",\"variable_sip_allow\":\"INVITE, ACK, BYE, CANCEL, OPTIONS, MESSAGE, INFO, UPDATE, REGISTER, REFER, NOTIFY\",\"variable_sip_recover_contact\":\"<sip:19123456789@192.168.0.57:9080;transport=udp>\",\"variable_sip_full_via\":\"SIP/2.0/UDP 192.168.0.216:9080;rport=9080;branch=z9hG4bK7FKeUrDN2S18B\",\"variable_sip_recover_via\":\"SIP/2.0/UDP 192.168.0.216:9080;rport=9080;branch=z9hG4bK7FKeUrDN2S18B\",\"variable_sip_full_from\":\"<sip:12345@192.168.0.216>;tag=19ZtB07Qc7KcH\",\"variable_sip_full_to\":\"<sip:19123456789@192.168.0.57:9080>;tag=09KSZygSvap7c\",\"variable_sip_from_user\":\"12345\",\"variable_sip_from_uri\":\"12345@192.168.0.216\",\"variable_sip_from_host\":\"192.168.0.216\",\"variable_sip_to_user\":\"19123456789\",\"variable_sip_to_port\":\"9080\",\"variable_sip_to_uri\":\"19123456789@192.168.0.57:9080\",\"variable_sip_to_host\":\"192.168.0.57\",\"variable_sip_contact_params\":\"transport=udp\",\"variable_sip_contact_user\":\"19123456789\",\"variable_sip_contact_port\":\"9080\",\"variable_sip_contact_uri\":\"19123456789@192.168.0.57:9080\",\"variable_sip_contact_host\":\"192.168.0.57\",\"variable_sip_to_tag\":\"09KSZygSvap7c\",\"variable_sip_from_tag\":\"19ZtB07Qc7KcH\",\"variable_sip_cseq\":\"35204434\",\"variable_sip_call_id\":\"0713bb1e-17d7-47fa-b3e1-061512878440\",\"variable_switch_r_sdp\":\"v=0\\r\\no=FreeSWITCH 1619487466 1619487467 IN IP4 192.168.0.57\\r\\ns=FreeSWITCH\\r\\nc=IN IP4 192.168.0.57\\r\\nt=0 0\\r\\nm=audio 28986 RTP/AVP 0 101\\r\\na=rtpmap:0 PCMU/8000\\r\\na=rtpmap:101 telephone-event/8000\\r\\na=fmtp:101 0-16\\r\\na=ptime:20\\r\\na=rtcp-mux\\r\\na=rtcp:28986 IN IP4 192.168.0.57\\r\\n\",\"variable_endpoint_disposition\":\"ANSWER\",\"variable_sip_reason\":\"Q.850;cause=16;text=\\\"NORMAL_CLEARING\\\"\",\"variable_sip_term_status\":\"200\",\"variable_proto_specific_hangup_cause\":\"sip:200\",\"variable_sip_term_cause\":\"16\",\"variable_sip_user_agent\":\"FreeSWITCH-mod_sofia/1.10.6-release.12~64bit\",\"variable_sip_hangup_disposition\":\"recv_bye\",\"variable_playback_last_offset_pos\":\"256160\",\"variable_playback_seconds\":\"33\",\"variable_playback_ms\":\"33018\",\"variable_playback_samples\":\"264144\",\"variable_current_application_response\":\"PLAYBACK ERROR\",\"variable_hangup_cause\":\"NORMAL_CLEARING\",\"variable_hangup_cause_q850\":\"16\",\"variable_digits_dialed\":\"none\",\"variable_start_stamp\":\"2021-04-27 17:40:52\",\"variable_profile_start_stamp\":\"2021-04-27 17:40:52\",\"variable_answer_stamp\":\"2021-04-27 17:40:54\",\"variable_progress_media_stamp\":\"2021-04-27 17:40:52\",\"variable_end_stamp\":\"2021-04-27 17:41:24\",\"variable_start_epoch\":\"1619516452\",\"variable_start_uepoch\":\"1619516452542864\",\"variable_profile_start_epoch\":\"1619516452\",\"variable_profile_start_uepoch\":\"1619516452542864\",\"variable_answer_epoch\":\"1619516454\",\"variable_answer_uepoch\":\"1619516454582862\",\"variable_bridge_epoch\":\"0\",\"variable_bridge_uepoch\":\"0\",\"variable_last_hold_epoch\":\"0\",\"variable_last_hold_uepoch\":\"0\",\"variable_hold_accum_seconds\":\"0\",\"variable_hold_accum_usec\":\"0\",\"variable_hold_accum_ms\":\"0\",\"variable_resurrect_epoch\":\"0\",\"variable_resurrect_uepoch\":\"0\",\"variable_progress_epoch\":\"0\",\"variable_progress_uepoch\":\"0\",\"variable_progress_media_epoch\":\"1619516452\",\"variable_progress_media_uepoch\":\"1619516452562840\",\"variable_end_epoch\":\"1619516484\",\"variable_end_uepoch\":\"1619516484582863\",\"variable_last_app\":\"playback\",\"variable_last_arg\":\"file_string://queue.wav!\",\"variable_caller_id\":\"\\\"19123456789\\\" <19123456789>\",\"variable_duration\":\"32\",\"variable_billsec\":\"30\",\"variable_progresssec\":\"0\",\"variable_answersec\":\"2\",\"variable_waitsec\":\"0\",\"variable_progress_mediasec\":\"0\",\"variable_flow_billsec\":\"32\",\"variable_mduration\":\"32040\",\"variable_billmsec\":\"30000\",\"variable_progressmsec\":\"0\",\"variable_answermsec\":\"2040\",\"variable_waitmsec\":\"0\",\"variable_progress_mediamsec\":\"20\",\"variable_flow_billmsec\":\"32040\",\"variable_uduration\":\"32039999\",\"variable_billusec\":\"30000001\",\"variable_progressusec\":\"0\",\"variable_answerusec\":\"2039998\",\"variable_waitusec\":\"0\",\"variable_progress_mediausec\":\"19976\",\"variable_flow_billusec\":\"32039999\",\"variable_rtp_audio_in_raw_bytes\":\"0\",\"variable_rtp_audio_in_media_bytes\":\"0\",\"variable_rtp_audio_in_packet_count\":\"0\",\"variable_rtp_audio_in_media_packet_count\":\"0\",\"variable_rtp_audio_in_skip_packet_count\":\"1601\",\"variable_rtp_audio_in_jitter_packet_count\":\"0\",\"variable_rtp_audio_in_dtmf_packet_count\":\"0\",\"variable_rtp_audio_in_cng_packet_count\":\"0\",\"variable_rtp_audio_in_flush_packet_count\":\"0\",\"variable_rtp_audio_in_largest_jb_size\":\"0\",\"variable_rtp_audio_in_jitter_min_variance\":\"0.00\",\"variable_rtp_audio_in_jitter_max_variance\":\"0.00\",\"variable_rtp_audio_in_jitter_loss_rate\":\"0.00\",\"variable_rtp_audio_in_jitter_burst_rate\":\"0.00\",\"variable_rtp_audio_in_mean_interval\":\"0.00\",\"variable_rtp_audio_in_flaw_total\":\"0\",\"variable_rtp_audio_in_quality_percentage\":\"100.00\",\"variable_rtp_audio_in_mos\":\"4.50\",\"variable_rtp_audio_out_raw_bytes\":\"275200\",\"variable_rtp_audio_out_media_bytes\":\"275200\",\"variable_rtp_audio_out_packet_count\":\"1600\",\"variable_rtp_audio_out_media_packet_count\":\"1600\",\"variable_rtp_audio_out_skip_packet_count\":\"0\",\"variable_rtp_audio_out_dtmf_packet_count\":\"0\",\"variable_rtp_audio_out_cng_packet_count\":\"0\",\"variable_rtp_audio_rtcp_packet_count\":\"0\",\"variable_rtp_audio_rtcp_octet_count\":\"0\"}";
        if(json.split("\"Hangup-Cause\"").length>2){
            json = json.replaceFirst("" +
                                     "\"Hangup-Cause\"","\"Hangup-Cause1\"");
        }
        gson.fromJson(json, Map.class);
    }
}
